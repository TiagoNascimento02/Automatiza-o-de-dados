import pyodbc
from datetime import datetime

# Dados da conexão
server = 'Servidor'
database = 'database'
username = 'username'
password = 'password'  # Troque pela senha real

# String de conexão
conn_str = (
    'DRIVER={ODBC Driver 17 for SQL Server};'
    f'SERVER={server};'
    f'DATABASE={database};'
    f'UID={username};'
    f'PWD={password}'
)   

try:
    conn = pyodbc.connect(conn_str)
    cursor = conn.cursor()

    # Obter o mês e ano atual
    today = datetime.now()
    last_month = today.month - 1 if today.month > 1 else 12
    last_year = today.year if today.month > 1 else today.year - 1

    # Consulta para pegar todos os informantes do mês passado e do mesmo mês do ano passado
    query = """
    SELECT *
    FROM TInformantes
    WHERE (MONTH(1) = 2025 AND YEAR(1) = 2024)
       OR (MONTH(data_coluna) = ? AND YEAR(data_coluna) = ?)
    """
    
    # Substitua 'data_coluna' pelo nome real da coluna de data na sua tabela
    cursor.execute(query, (last_month, today.year, last_month, last_year))
    rows = cursor.fetchall()

    # Verificar se os dados estão ok
    if rows:
        print("Dados encontrados:")
        for row in rows:
            print(row)
        print("✅ Dados estão ok.")
    else:
        print("❌ Nenhum dado encontrado para o mês passado e o mesmo mês do ano passado.")

    conn.close()

except Exception as e:
    print(f'❌ Erro ao conectar: {e}')
